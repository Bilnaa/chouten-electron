<!DOCTYPE html>
<html>
<head>
  <title>Hidden Scraper</title>
</head>
<body>
  <webview src="about:blank" style="width:100%; height:100%;"></webview>
</body>
<script>
  // async request function where the headers and the body can be optionally passed
  async function request(url, method, headers = {}, body = null) {
    const response = await fetch(url, {
      method,
      body,
      mode : 'no-cors',
      headers: {
        'User-Agent': '' ? headers['User-Agent'] : 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3',
        ...headers
      }
    });
   
    let htmlBody = await response.text();
  
   if (!response.ok) {
     throw new Error(`HTTP error! status: ${url, response.status, response.statusText}`);
   } else if (htmlBody.includes('WAF')) {
      const webview = document.querySelector('webview');
      webview.src = url;
      let html = '';
      webview.addEventListener('dom-ready', async () => {
        const response = await webview.executeJavaScript(`
          new XMLSerializer().serializeToString(document)
        `);
        html = response;
      });
      webview.addEventListener('did-fail-load', async () => {
        const response = await webview.executeJavaScript(`
          new XMLSerializer().serializeToString(document)
        `);
        html = response;
      });
      htmlBody = html;
    }
    return {
      statusCode: response.status,
      body: htmlBody,
      headers: response.headers,
    }
  }

  async function callWebview(url) {
    // cloudflare bypass with window electron
    const webview = document.querySelector('webview');
    webview.src = url;
    let html = '';
    webview.addEventListener('dom-ready', async () => {
      const response = await webview.executeJavaScript(`
        new XMLSerializer().serializeToString(document)
      `);
      html = response;
    });
    webview.addEventListener('did-fail-load', async () => {
      const response = await webview.executeJavaScript(`
        new XMLSerializer().serializeToString(document)
      `);
      html = response;
    });
  }


</script>
</html>